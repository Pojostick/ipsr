$(function(){var t=$("#APPDATA").attr("steps"),i=parseInt($("#APPDATA").attr("width")),s=parseInt($("#APPDATA").attr("height")),r=[],a=[],e=0,n=60,h=250,o=document.getElementById("display"),l=o.getContext("2d");o.width=i*n,o.height=s*n;var f=[],d=-1,v=function(t,i,s,r){this.id=++e,a[this.id]=this,this.x=i,this.y=s,this.z=r,this.color=t,this.animation=!1,this.draw=function(t){if(!(this.z<=.01)){this.z>=.99&&(this.z=1);var i=Math.round(n*this.x),s=Math.round(n*this.y);t.globalAlpha=this.z,t.setLineDash([]),t.strokeStyle="#fff",t.lineWidth=.5,t.strokeRect(i,s,n,n),t.fillStyle=this.color,t.fillRect(i,s,n,n),t.globalAlpha=1}}},u=function(t,i,s,r,a,e,n,h){this.id=void 0,this.tile=t,this.ax=i,this.ay=s,this.az=r,this.bx=a,this.by=e,this.bz=n,this.instant=h,this.progress=0,this["do"]=function(){var t=!0;return(this.progress<0||this.progress>1)&&(t=!1),this.progress<0&&(this.progress=0),this.progress>1&&(this.progress=1),this.tile.x=this.ax+(this.bx-this.ax)*this.progress,this.tile.y=this.ay+(this.by-this.ay)*this.progress,this.tile.z=this.az+(this.bz-this.az)*this.progress,t}},p=function(t){if(d<f.length-1){d++;var i=f[d];for(var s in i){var r=i[s];if(r.progress=0,r.tile.animation){var a=f[r.tile.animation];for(var e in a){var n=a[e];clearTimeout(n.id),n.progress=1,n["do"]()}r.tile.animation=!1}if(t||r.instant)r.progress=1,r["do"]();else{var h=0,o=Math.abs(r.ax-r.bx)+Math.abs(r.ay-r.by);o=.25-.2*Math.min(o/10,1);var l=function(){h++,r.progress+=o,r["do"]()&&h<20?r.id=setTimeout(l,25):r.tile.animation=!1};r.tile.animation=d,r.id=setTimeout(l,25)}}return!0}return!1},g=function(t){if(d>=0){var i=f[d];for(var s in i){var r=i[s];if(r.progress=1,r.tile.animation){var a=f[r.tile.animation];for(var e in a){var n=a[e];clearTimeout(n.id),n.progress=0,n["do"]()}r.tile.animation=!1}if(t||r.instant)r.progress=0,r["do"]();else{var h=0,o=Math.abs(r.ax-r.bx)+Math.abs(r.ay-r.by);o=.25-.2*Math.min(o/10,1);var l=function(){h++,r.progress-=o,r["do"]()&&h<20?r.id=setTimeout(l,25):r.tile.animation=!1};r.tile.animation=d,r.id=setTimeout(l,25)}}return d--,!0}return!1};t=t.split(",");for(var m=0;m<t.length;m++){var c=t[m].split(" ");if(1!=c.length){var b=parseInt(c[0]),y=parseInt(c[1]),x=b%i,w=Math.floor(b/i),A=y%i,M=Math.floor(y/i);if(b==-1&&y!=-1){var z=new v(c[2],A,M,0);r[y]=z,f.push([new u(z,A,M,0,A,M,1)])}else if(b!=-1&&y==-1){var z=r[b];f.push([new u(z,x,w,1,x,w,0)])}else if(b!=-1&&y!=-1){var T=r[b],P=r[y];r[b]=P,r[y]=T,T&&P?f.push([new u(P,A,M,1,A,M,0,!0),new u(T,x,w,1,A,M,1)]):T?f.push([new u(T,x,w,1,A,M,1)]):P&&f.push([new u(P,A,M,1,x,w,1)])}p(!0)}}p(!0),h=f.length;var I=$("#handle"),D=$("#slider");$("#slider").slider({min:1,max:h+1,value:h+1});var R=0,k=function(){if(R=$("#slider").slider("value")-2-d,R<-10)for(var t=0;t<Math.abs(R/10);t++)g(!0);else if(R>10)for(var t=0;t<Math.abs(R/10);t++)p(!0);R<0?g():R>0&&p(),I.text(d+2+" ["+D.slider("value")+"]"),setTimeout(k,100)};setTimeout(k,100);var S=function(){requestAnimationFrame(S),l.clearRect(0,0,o.width,o.height);for(var t=0;t<i*s;t++)r[t]&&r[t].draw(l);for(var e in a)a[e].draw(l)};S()});